# Development Dockerfile with hot reload
FROM node:20-alpine

WORKDIR /app

# Install dependencies
COPY package.json package-lock.json* ./
RUN npm ci

# Install tsx globally for hot reload
RUN npm install -g tsx

# Copy source code (will be mounted as volume in docker-compose)
COPY . .

# Generate Prisma Client
RUN npx prisma generate

# Create directories
RUN mkdir -p uploads/profiles uploads/kyc uploads/voice-bios uploads/events uploads/messages && \
    mkdir -p logs && \
    chmod +x /app/scripts/docker-entrypoint.sh 2>/dev/null || true

EXPOSE 3000

# Use tsx for hot reload
CMD ["npm", "run", "dev"]

